## 목표
- 자바 소스 파일(.java)을 JVM으로 실행하는 과정 이해하기.


### JVM이란 무엇인가
	Java Virtual Machine 의 줄임말로, 자바를 실행하기 위한 가상 머신이다.
	가상 머신이란 컴퓨터 환경을 소프트웨어로 구현한 것을 말한다.
	
	JVM 의 역할은 Java compiler 가 변환 시켜 주는 자바 바이트 코드를 해석하여 실행하는 것이다.
	자바 바이트 코드는 플랫폼에 독립적이며 모든 자바 가상 머신은 가상 머신 규격에 정의된 대로 
	자바 바이트 코드를 실행 한다. 따라서 표준 자바 API 까지 동일한 동작을 하도록 구현한 상태에서는
	이론적으로 모든 자바 프로그램은 CPU나 운영 체제의 종류와 무관하게 동일하게 동작할 것을 보장한다.
	JVM 위에서 OS 에 상관없이 실행 되고 Java의 가장 큰 장점이라고 할 수 있다.
	다른 일반 애플리케이션의 코드는 OS만 거치고 하드웨어로 전달되는데 비해 Java 는 JVM 을 한 번 더 
	거치기도 하고 하드웨어 맞게 완전히 컴파일된 상태가 아니라 실행 시에 해석 되기 때문에 속도가 
	느리다는 단점이 있다. 그러나 요즘은 바이트 코드를 하드웨어의 기계어로 바로 변환해주는 JIT 컴파일러와
	향상된 최적화 기술이 적용되어서 속도의 격차를 많이 줄였다.

	또한 가장 중요한 `메모리관리`, `Garbage collection` 을 수행 한다.
	JVM 은 스택 기반의 가상 머신이다.

### 컴파일 하는 방법
 1. xxxx.java 등의 소스파일을 작성한다. 
 2. javac(자바컴파일러) 명령어를 사용하면 xxxx.java 파일에서 xxxx.class 파일로 컴파일 된다.
 3. 만약 컴파일 시에 오류가 발생하면 에러메세지가 뜬다.
   
### 실행하는 방법
 작성한 소스 코드를 컴파일러를 사용하여 .class 파일을 만들어 주었다면 실행 가능한 상태이다.
 이 상태에서 자바 인터프리터(java) 명령어를 사용하여 해당 파일을 실행하면 된다.

### 바이트 코드란 무엇인가
특정 하드웨어가 아닌 가상 컴퓨터에서 돌아가는 실행 프로그램을 위한 이진 표현법이다.
자바 컴파일러가 컴파일 하여 생성되는 .class 파일이 바이트 코드로 변경 된 것이다.
이를 JVM이 사용한다.
사람이 작성한 소스 코드와 기계가 실행 하는 기계어의 중간 단계의 형태의 코드로 볼 수 있다.

### JIT(just-in-time) 컴파일러란 무엇이며 어떻게 동작하는지
프로그램을 실제 실행하는 시점에 기계어로 번역하는 컴파일 기법이다.
컴퓨터 프로그램을 만드는 방법은 두가지가 있는데, 인터프리트 방식과 정적 컴파일 방식으로 나뉜다.
인터프리트 방식은 실행 중에 프로그램 언어를 한줄 한줄 읽어가면서 처리한다.
정적 컴파일은 실행하기 전에 프로그램 코드를 기계어로 번역한다.

JIT 컴파일러는 위의 두가지 방식을 혼합한 방식이라 한다.
실행 시점에 인터프리트 방식으로 기계어 코드를 생성하고 그 코드를 캐싱하여 같은 함수가 여러 번 불릴때
매번 기계어 코드를 생성하는 것을 방지한다.

자바 컴파일러가 자바 바이트 코드로 컴파일 하면 JVM이 바이트 코드를 실행하는 시점에 JIT 컴파일을 통해 기계어로 변환한다.

- 인터프리터
  - 바이트 코드 명령어를 하나씩 읽어 해석하고 실행
  - 하나씩 해석하고 실행하기 때문에 하나하의 해석은 빠르나 결과의 실행은 느리다.
  - 바이트 코드라는 언어는 기본적으로 인터프리터 방식으로 동작.
- JIT(just-in-time) 캄파일러
  - 인터프리터 방식의 단점을 보안
  - 인터프리터 방식으로 실행하다가 적절한 시점에 바이트 코드 전체를 컴파일하여 네이티브 코드로 변경하고
	캐시에 저장한 후 직접 실행하는 방식

### JVM 구성 요소
클래스 로더가 바이트 코드를 런타임 데이터 영역에 로드하고 실행 엔진이 바이트 코드를 실행하는 구조

1. 클래스 로더
	실행 시점에 클래스를 처음 참조할 때 해당 클래스를 로드하고 링크하는 방식을 취한다.
	이 동적 로드를 담당하는 부분이 JVM의 클래스 로더 이다.

2. 런타임 데이터 영역
	JVM이 운영체제 위에서 실행되면서 할당 받는 메모리 영역이다.
	런타임 데이터 영역에서 PC레지스터, JVM 스택, 네이티브 메서드 스택은 스레드 마다 하나씩 생성되며 힙과 메서드 영역은 
	모든 스레드가 공유한다.
	- PC 레지스터: 스레드가 시작될 때 생성되고 현재 수행 중인 JVM 명령의 주소를 갖는다.
	- JVM 스택: 스레드가 시작될 때 생성된다. 스택 프레임이라는 구조체를 저장하는 스택이다.
	- 스택 프레임: JVM 내에서 메서드가 수행될 때마다 하나의 스택 프레임이 생성되어 해당 스레드의 JVM 스택에 추가되고 메서드가 종료되면 스택 프레임이 제거된다. 스택 프레임은 지역 변수 배열, 피연산자 스택, 현재 실행 중인 메서드가 속한 클래스의 런타임 상수 풀에 대한 레퍼런스를 갖는다.
	- 지역 변수 배열: 0부터 시작하는 인덱스를 가진 배열
	0은 메서드가 속한 클래스 인스턴스의 this 레퍼런스고, 1부터는 메서드에 전달 된 파라미터들이 저장되고 그 이후에는 지역 변수들이 
	저장 된다.
	- 피연산자 스택: 메서드의 실제 작업 공간이다.
	- 네이티브 메서드 스택: 자바 외의 언어로 작성된 네이티브 코드를 위한 스택. C/C++ 등의 코드를 수행하기 위한 스택으로 C 스택이나
	C++ 스택이 생성된다.
	- 메서드 영역: 메서드 영역은 모든 스레드가 공유하는 영역으로 JVM이 시작될 때 생성된다.
	- 런타임 상수 풀: JVM 동작에서 가장 핵심적인 역할을 수행하는 곳이다. 
	각 클래스와 인터페이스의 상수, 메서드와 필드에 대한 모든 레퍼런스까지 담고 있는 테이블이다.
	어떤 메서드나 필드를 참조할 때 JVM은 런타임 상수 풀을 통해 해당 메서드나 필드의 실제 메모리상 주소를 찾아 참조한다.
	- 힙: 인스턴스 또는 객체를 저장하는 공간으로 가비지 컬렉션 대상이다.

3. 실행 엔진
  - 클래스 로더가 JVM 내의 런타임 데이터 영역에 배치한 바이트 코드를 실행하는 역할을 한다.

### JDK와 JRE의 차이
- JRE(Java Runtime Enviroment): 컴파일 된 자바 프로그램을 실행시킬 수 있는 자바환경이다.
JVM이 자바프로그램을 실행시킬 때 반드시 필요한 라이브러리 및 기타 필수 파일을 가지고 있다.
자바 프로그램 개발이 아닌 단순히 자바 프로그램을 실행만 하려면 JRE만 설치하면 된다.
JRE 에는 코어 자바 클래스 라이브러리, 자바 클래스 로더, 자바 가상 머신이 포함된다.

- JDK(Java Development kit): 자바 개발도구(Java Development Kit) 의 약자이다.
JDK 는 JRE + 개발을 위해 필요한 도구(javac, java등)들을 포함한다.
자바 개발 및 실행하는데 필요한 툴들을 제공한다.

JDK가 자바 기반 소프트웨어를 개발하기 위한 도구들로 이뤄진 패키지이다.
JRE는 자바 코드를 실행하기 위한 도구들로 구성된 패키지이다.
JRE는 JDK의 일부이기도 하다. 자바 프로그램을 구동하는 것이 자바 프로그램 개발의 일환이기 때문에
JDK는 JRE를 필요로 한다.

### 참고
- [자바 가상 머신](https://ko.wikipedia.org/wiki/%EC%9E%90%EB%B0%94_%EA%B0%80%EC%83%81_%EB%A8%B8%EC%8B%A0)
- [바이트 코드](https://ko.wikipedia.org/wiki/%EB%B0%94%EC%9D%B4%ED%8A%B8%EC%BD%94%EB%93%9C)
- [자바 바이트 코드](https://ko.wikipedia.org/wiki/%EC%9E%90%EB%B0%94_%EB%B0%94%EC%9D%B4%ED%8A%B8%EC%BD%94%EB%93%9C)
- [JIT 컴파일](https://ko.wikipedia.org/wiki/JIT_%EC%BB%B4%ED%8C%8C%EC%9D%BC)
- [JVM의 구조](https://odol87.tistory.com/5)